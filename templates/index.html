<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Ã‰cole de Mama Binta</title>

    <!-- PWA -->
    <link rel="manifest" href="/static/manifest.json">

    <script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/static/sw.js");
    }
    </script>

    <style>
    body {
        font-family: Arial, sans-serif;
        background: #fef6e4;
        text-align: center;
        padding: 30px;
    }
    h1 { color: #f582ae; }

    button {
        font-size: 18px;
        padding: 12px 20px;
        margin: 6px;
        border: none;
        border-radius: 10px;
        background: #8bd3dd;
        cursor: pointer;
    }

    button:hover {
        background: #5ec2c9;
    }

    .choice {
        background: #ffd803;
    }

    #box {
        margin-top: 20px;
        font-size: 20px;
        white-space: pre-line;
    }

    #score {
        margin-top: 20px;
        font-size: 18px;
        background: #e3f6f5;
        padding: 10px;
        border-radius: 10px;
        display: inline-block;
    }
    </style>
</head>

<body>

<h1>Ã‰cole de Mama Binta ğŸ‘§ğŸ“š</h1>

<div id="score">
    â­ Points : <span id="points">0</span><br>
    ğŸ… Niveau : <span id="level">1</span>
</div>

<h2>ğŸ“– Lecture</h2>
<button onclick="getReadingLesson()">LeÃ§on</button>
<button onclick="getReadingExercise()">Exercice</button>

<h2>âœï¸ Ã‰criture</h2>
<button onclick="getWritingExercise()">Exercice dâ€™Ã©criture</button>

<h2>â•â– MathÃ©matiques</h2>
<button onclick="getAddition()">Addition</button>
<button onclick="getSubtraction()">Soustraction</button>

<div id="box"></div>

<script>
let correctAnswer = null;
let points = 0;
let level = 1;

function updateScore() {
    document.getElementById("points").innerText = points;
    document.getElementById("level").innerText = level;
}

function addPoint() {
    points++;
    if (points % 5 === 0) {
        level++;
    }
    updateScore();
}

// -------- LECTURE --------

function getReadingLesson() {
    fetch("/lesson/reading")
        .then(r => r.json())
        .then(d => {
            document.getElementById("box").innerText =
                d.title + "\n\n" + d.content;
        });
}

function getReadingExercise() {
    fetch("/exercise/reading")
        .then(r => r.json())
        .then(d => {
            correctAnswer = d.answer;
            let html = d.question + "\n\n";
            d.choices.forEach(c => {
                html += `<button class="choice" onclick="check('${c}')">${c}</button><br>`;
            });
            document.getElementById("box").innerHTML = html;
        });
}

// -------- Ã‰CRITURE --------

function getWritingExercise() {
    fetch("/exercise/writing")
        .then(r => r.json())
        .then(d => {
            correctAnswer = d.answer;
            let html = "âœï¸ " + d.question + "\n\n";
            d.choices.forEach(c => {
                html += `<button class="choice" onclick="check('${c}')">${c}</button><br>`;
            });
            document.getElementById("box").innerHTML = html;
        });
}

// -------- MATHS --------

function getAddition() {
    fetch("/math/addition")
        .then(r => r.json())
        .then(d => {
            document.getElementById("box").innerText =
                d.question + "\n\nRÃ©ponse : " + d.answer;
        });
}

function getSubtraction() {
    fetch("/math/subtraction")
        .then(r => r.json())
        .then(d => {
            document.getElementById("box").innerText =
                d.question + "\n\nRÃ©ponse : " + d.answer;
        });
}

// -------- CHECK --------

function check(choice) {
    if (choice === correctAnswer) {
        addPoint();
        document.getElementById("box").innerText =
            "Bravo Mama Binta ğŸ‰â­";
    } else {
        document.getElementById("box").innerText =
            "Ce nâ€™est pas grave, essaie encore ğŸ˜Š";
    }
}
</script>

</body>
</html>
