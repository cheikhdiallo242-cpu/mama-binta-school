<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>√âcole de Mama Binta</title>

    <!-- PWA -->
    <link rel="manifest" href="/static/manifest.json">

    <script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/static/sw.js");
    }
    </script>

    <style>
    body {
        font-family: Arial, sans-serif;
        background: #fef6e4;
        text-align: center;
        padding: 30px;
    }
    h1 { color: #f582ae; }

    button {
        font-size: 18px;
        padding: 12px 20px;
        margin: 6px;
        border: none;
        border-radius: 10px;
        background: #8bd3dd;
        cursor: pointer;
    }

    button:hover {
        background: #5ec2c9;
    }

    .choice {
        background: #ffd803;
    }

    #box {
        margin-top: 20px;
        font-size: 20px;
        white-space: pre-line;
    }

    #score {
        margin-top: 20px;
        font-size: 18px;
        background: #e3f6f5;
        padding: 10px;
        border-radius: 10px;
        display: inline-block;
    }
    </style>
</head>

<body>

<h1>√âcole de Mama Binta üëßüìö</h1>

<div id="score">
    ‚≠ê Points : <span id="points">0</span><br>
    üèÖ Niveau : <span id="level">1</span>
</div>

<h2>üìñ Lecture</h2>
<button onclick="getReadingLesson()">Le√ßon</button>
<button onclick="getReadingExercise()">Exercice</button>

<h2>‚úçÔ∏è √âcriture</h2>
<button onclick="getWritingExercise()">Exercice d‚Äô√©criture</button>

<h2>‚ûï‚ûñ Math√©matiques</h2>
<button onclick="getAddition()">Addition</button>
<button onclick="getSubtraction()">Soustraction</button>

<div id="box"></div>

<script>
let correctAnswer = null;
let points = 0;
let level = 1;

/* -------- SCORE -------- */
function updateScore() {
    document.getElementById("points").innerText = points;
    document.getElementById("level").innerText = level;
}

function addPoint() {
    points++;
    if (points % 5 === 0) {
        level++;
    }
    updateScore();
}

/* -------- VOIX -------- */
function speak(text) {
    if (!("speechSynthesis" in window)) return;

    window.speechSynthesis.cancel();

    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = "fr-FR";
    msg.rate = 0.9;
    msg.pitch = 1.1;

    window.speechSynthesis.speak(msg);
}

/* -------- LECTURE -------- */
function getReadingLesson() {
    fetch("/lesson/reading")
        .then(r => r.json())
        .then(d => {
            const text = d.title + ". " + d.content;
            document.getElementById("box").innerText = text;
            speak(text);
        });
}

function getReadingExercise() {
    fetch("/exercise/reading")
        .then(r => r.json())
        .then(d => {
            correctAnswer = d.answer;
            speak(d.question);

            let html = d.question + "\n\n";
            d.choices.forEach(c => {
                html += `<button class="choice" onclick="check('${c}')">${c}</button><br>`;
            });
            document.getElementById("box").innerHTML = html;
        });
}

/* -------- √âCRITURE -------- */
function getWritingExercise() {
    fetch("/exercise/writing")
        .then(r => r.json())
        .then(d => {
            correctAnswer = d.answer;
            speak(d.question);

            let html = "‚úçÔ∏è " + d.question + "\n\n";
            d.choices.forEach(c => {
                html += `<button class="choice" onclick="check('${c}')">${c}</button><br>`;
            });
            document.getElementById("box").innerHTML = html;
        });
}

/* -------- MATHS -------- */
function getAddition() {
    fetch("/math/addition")
        .then(r => r.json())
        .then(d => {
            const text = d.question + ". La r√©ponse est " + d.answer;
            document.getElementById("box").innerText = text;
            speak(text);
        });
}

function getSubtraction() {
    fetch("/math/subtraction")
        .then(r => r.json())
        .then(d => {
            const text = d.question + ". La r√©ponse est " + d.answer;
            document.getElementById("box").innerText = text;
            speak(text);
        });
}

/* -------- CHECK -------- */
function check(choice) {
    if (choice === correctAnswer) {
        addPoint();
        document.getElementById("box").innerText =
            "Bravo Mama Binta üéâ‚≠ê";
        speak("Bravo Mama Binta !");
    } else {
        document.getElementById("box").innerText =
            "Ce n‚Äôest pas grave, essaie encore";
        speak("Ce n‚Äôest pas grave, essaie encore");
    }
}
</script>

</body>
</html>
